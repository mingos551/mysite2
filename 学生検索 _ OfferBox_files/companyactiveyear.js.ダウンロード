// 企業の採用活動年度更新ajax
$(function(){
    $('#form_ACTIVEYEAR').change(function() {
        $.ajax({
            url: $(this).data('topurl') + '/cprofactiveyear/set',
            type: "POST",
            dataType : 'json',
            cache: false,
            data: {
                'COMPANY_ID': $(this).data('cid'),
                'ACTIVEYEAR': $(this).val()
            }
        }).done(function() {
            location.reload();
        }).fail(function(jqXHR) {
            const responseText = JSON.parse(jqXHR.responseText);
            alert("採用活動年度変更に失敗しました。ページをリロード後再度お試しください。\n\n" + responseText.result);
        });
    });


    var before_change_activeyear =  $('#company_activeyear_change input[name=activeyear]:checked').val()

    $(document).on('change', '#company_activeyear_change input', function(event) {
        // NOTE:
        // 活動年度更新前の確認処理
        //   活動年度を変更した際、画面のリロードが走りフォームの値がリセットされるため
        //   確認モーダルを表示したい場合はJSによりis-confirmのフラグをページごとに動的にセットすること
        if($('#company_activeyear_change').attr('is-confirm')){
          if (!window.confirm('保存前の情報は全てリセットされます。よろしいですか？')) {
              $('#company_activeyear_change input[name=activeyear]').val([before_change_activeyear])
              return false;
          }
        }

        $('#company_activeyear_change input').prop('disabled', true);
        $.ajax({
            url      : '/cprofactiveyear/set',
            type     : 'POST',
            dataType : 'json',
            cache    : false,
            data     : {
                'COMPANY_ID': $('#company_activeyear_change').data('cid'),
                'ACTIVEYEAR': $(this).val()
            }
        })
        .done(function() {
            location.reload();
        })
        .fail(function(jqXHR) {
            const responseText = JSON.parse(jqXHR.responseText);
            alert("採用活動年度変更に失敗しました。ページをリロード後再度お試しください。\n\n" + responseText.result);
        });
    });

});
