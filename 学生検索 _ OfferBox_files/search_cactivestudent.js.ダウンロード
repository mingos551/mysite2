$(function() {
    init();

    // 高評価学生検索 設定
    $('input[name="activestudent_score"]').not('#cactivestudent_search_reset').change(function(e) {
        var mode = $('#competence_search_activestudent').data('competence-search-type');
        var selected = $('input[name="activestudent_score"]:checked').val();
        if (isAddableSearchConditions(mode)) {
            $('#form_competence_search_flag').val(mode);
            $('input[name="activestudent_score"][value="' + selected + '"]').prop('checked', true);
            $('#cactivestudent_search_checked').show();
            $('#cactivestudent_search_checked_item').text('偏差値' + selected + '以上');
        } else {
            $('input[name="activestudent_score"][value="0"]').prop('checked', true);
        }
    });

    $('.cactivestudent_search_reset_label').on('click', function(event) {
        resetSearchActivestudent();
        set_search_count(make_search_params());
    });

    function init() {
        setCondition();
    }

    function setCondition() {
        var activestudentScore = getParam('activestudent_score');
        var postactivestudentScore = $('input[name="post_activestudent_score"]').val();
        var competence_search_type = $('#competence_search_activestudent').data('competence-search-type');

        if (postactivestudentScore > 0) {
            $('#cactivestudent_search_checked_item').text('偏差値' + postactivestudentScore + '以上');
            $('input[name="activestudent_score"][value="' + postactivestudentScore +'"]').prop('checked', true);
            $('#cactivestudent_search_checked').show();
            $('#form_competence_search_flag').val(competence_search_type);
        }

        if (activestudentScore > 0) {
            if (isAddableSearchConditions(competence_search_type)) {
                $('#cactivestudent_search_checked_item').text('偏差値' + activestudentScore + '以上');
                $('input[name="activestudent_score"][value="' + activestudentScore +'"]').prop('checked', true);
                $('#cactivestudent_search_checked').show();
                $('#form_competence_search_flag').val(competence_search_type);
            }
        }
    }

    function getParam(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
})
